# Linux Traces

## strace

1. sudo strace -o/dev/null /bin/bash --> Privilege Escalation
2. Analysis on capabilities current process is running. Identify risky capabilities for further exploitation. 
    Ex: Analysis of ping command `sudo strace ping $IP`. (CAP_NET_ADMIN/ CAP_NET_RAW)
    https://blog.pentesteracademy.com/linux-security-understanding-linux-capabilities-series-part-i-4034cf8a7f09
3. Stealing SSH credentials --> strace -f -p $(pgrep -f "/usr/sbin/sshd") -s 128 -o /root/.gpg/auth.log
    https://mthbernardes.github.io/persistence/2018/01/10/stealing-ssh-credentials.html
4. Analysis of running process to identify shared lib, which can be replaced with malisious lib for further exploit. 
    https://bltsec.ninja/2017/12/23/penetration-testing-linux-local-privilege-escalation-dev-random-k2/
5. Strace overall --> https://www.poftut.com/trace-system-calls-signals-strace-command-examples/
6. finding command injections on a router using strace --> https://medium.com/@jam3s/finding-command-injections-on-a-router-using-strace-16dfc2e8648b

## ltrace

1. The ltrace command can be used to intercept and record the dynamic calls made to shared libraries. The amount of output generated by the ltrace command can be overwhelming for some commands (especially if the -S option is used to also show system calls). You can focus the output to just the interaction between the program and some list of libraries. For example, to execute the id -Z command and show the calls made to the libselinux.so module, execute: `ltrace -l /lib/libselinux.so.1 id -Z`
https://exitno.de/reversing/

## ptrace

Ptrace is a system call function. can be used to write rootkit kernel module for furter exploitation. 




## Important Points

1. What’s the difference between ltrace and strace?
   Both ltrace and strace give you similar information, but with an important difference:

  strace intercepts system calls make by the glibc and other libraries directly into the Linux Kernel. It uses a tool called ptrace to inspect the system calls of a process.
  ltrace intercepts library calls and system calls made by your application to C libraries such as the glibc. It doesn’t use LD_PRELOAD, but the information that you get is very similar.
  https://www.ellexus.com/tracing-technology-ltrace-strace/#:~:text=Both%20ltrace%20and%20strace%20give,directly%20into%20the%20Linux%20Kernel.&text=ltrace%20intercepts%20library%20calls%20and,libraries%20such%20as%20the%20glibc.

2. Ltrace and strace only work on executables, but the good news is that you can still trace scripts by tracing the script interpreter:

`ltrace python myscript.py`
https://www.ellexus.com/getting-started-with-ltrace-how-does-it-do-that/

3. ltrace/strace/dtrace --> https://dev.to/captainsafia/say-this-five-times-fast-strace-ptrace-dtrace-dtruss-3e1b
